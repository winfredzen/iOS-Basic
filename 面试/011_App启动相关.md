# App启动相关

参考：

+ [02 | App 启动速度怎么做优化与监控？](https://time.geekbang.org/column/article/85331?utm_term=zeus1Z0MB&utm_source=weibo&utm_medium=daiming&utm_campaign=presell-161&utm_content=daiming0320)



**main()函数执行之前**

> + 加载可执行文件（App 的.o 文件的集合）；
> + 加载动态链接库，进行 `rebase` 指针调整和 `bind` 符号绑定；
> + Objc 运行时的初始处理，包括 Objc 相关类的注册、`category` 注册、`selector` 唯一性检查等；
> + 初始化，包括了执行 `+load()` 方法、`attribute((constructor))` 修饰的函数的调用、创建 C++ 静态全局变量。



**启动速度优化可以做的事情**

> + 减少动态库加载。每个库本身都有依赖关系，苹果公司建议使用更少的动态库，并且建议在使用动态库的数量较多时，尽量将多个动态库进行合并。数量上，苹果公司建议最多使用 6 个非系统动态库。
>
> + 减少加载启动后不会去使用的类或者方法。
>
> + `+load()` 方法里的内容可以放到首屏渲染完成后再执行，或使用 `+initialize()` 方法替换掉。因为，在一个 `+load()` 方法里，进行运行时方法替换操作会带来 4 毫秒的消耗。不要小看这 4 毫秒，积少成多，执行 `+load()` 方法对启动速度的影响会越来越大。
>
> + 控制 C++ 全局变量的数量。



**main() 函数执行后**

> main() 函数执行后的阶段，指的是从 main() 函数执行开始，到 appDelegate 的 didFinishLaunchingWithOptions 方法里首屏渲染相关方法执行完成。
>
> 首页的业务代码都是要在这个阶段，也就是首屏渲染前执行的，主要包括了：
>
> + 首屏初始化所需配置文件的读写操作；
> + 首屏列表大数据的读取；
> + 首屏渲染的大量计算等。
>
> 很多时候，开发者会把各种初始化工作都放到这个阶段执行，导致渲染完成滞后。更加优化的开发方式，应该是**从功能上梳理出哪些是首屏渲染必要的初始化功能**，哪些是 App 启动必要的初始化功能，而哪些是只需要在对应功能开始使用时才需要初始化的。梳理完之后，将这些初始化功能分别放到合适的阶段进行。





























